<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The recovery module"><title>matrix_sdk::encryption::recovery - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b1a3e7f8283b8434.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="matrix_sdk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0-nightly (d5fd09972 2024-01-22)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../matrix_sdk/index.html">matrix_sdk</a><span class="version">0.7.1</span></h2></div><h2 class="location"><a href="#">Module recovery</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In matrix_sdk::encryption</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../matrix_sdk/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">matrix_sdk</a>::<wbr><a href="../index.html">encryption</a>::<wbr><a class="mod" href="#">recovery</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../../src/matrix_sdk/encryption/recovery/mod.rs.html#15-522">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>The recovery module</p>
<p>The recovery module attempts to provide a unified and simplified view over
the secret storage and backup subsystems.</p>
<p><strong>Note</strong>: If you are using this module, do not use the <a href="../secret_storage/struct.SecretStorage.html" title="struct matrix_sdk::encryption::secret_storage::SecretStorage"><code>SecretStorage</code></a> and
<a href="../backups/struct.Backups.html" title="struct matrix_sdk::encryption::backups::Backups"><code>Backups</code></a> subsystems directly. This module makes assumptions that might be
broken by the direct usage of the respective lower level modules.</p>
<p><strong>Note</strong>: The term Recovery used in this submodule is not the same as the
<a href="https://spec.matrix.org/v1.8/client-server-api/#recovery-key"><code>Recovery key</code></a> mentioned in the spec. The recovery key from the spec is
solely about backups, while the term recovery in this file includes both the
backups and the secret storage subsystems. The recovery key mentioned in
this file is the secret storage key.</p>
<p>You should configure your client to bootstrap cross-signing automatically
and may chose to let your client automatically create a backup, if it
doesn’t exist, as well:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>matrix_sdk::{encryption::EncryptionSettings, Client};

<span class="kw">let </span>client = Client::builder()
    .homeserver_url(homeserver)
    .with_encryption_settings(EncryptionSettings {
        auto_enable_cross_signing: <span class="bool-val">true</span>,
        auto_enable_backups: <span class="bool-val">true</span>,
        ..Default::default()
    })
    .build()
    .<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<p>For a newly registered user you will want to enable recovery, either
immediately or before the user logs out.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>recovery = client.encryption().recovery();

<span class="comment">// Create a new recovery key, you can use the provided passphrase, or the returned recovery key
// to recover.
</span><span class="kw">let </span>recovery_key = recovery
    .enable()
    .wait_for_backups_to_upload()
    .with_passphrase(<span class="string">"my passphrase"</span>)
    .<span class="kw">await</span>;</code></pre></div>
<p>If the user logs in with another device, you’ll want to let the user recover
its secrets by entering the recovery key or recovery passphrase.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>recovery = client.encryption().recovery();

<span class="comment">// Create a new recovery key, you can use the provided passphrase, or the returned recovery key
// to recover.
</span>recovery.recover(<span class="string">"my recovery key or passphrase"</span>).<span class="kw">await</span>;</code></pre></div>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="futures/index.html" title="mod matrix_sdk::encryption::recovery::futures">futures</a></div><div class="desc docblock-short">Named futures for the recovery support.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Recovery.html" title="struct matrix_sdk::encryption::recovery::Recovery">Recovery</a></div><div class="desc docblock-short">The recovery manager for the <a href="../../struct.Client.html" title="struct matrix_sdk::Client"><code>Client</code></a>.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.EnableProgress.html" title="enum matrix_sdk::encryption::recovery::EnableProgress">EnableProgress</a></div><div class="desc docblock-short">Enum describing the states the <a href="struct.Recovery.html#method.enable" title="method matrix_sdk::encryption::recovery::Recovery::enable"><code>Recovery::enable()</code></a> method can be in.</div></li><li><div class="item-name"><a class="enum" href="enum.RecoveryError.html" title="enum matrix_sdk::encryption::recovery::RecoveryError">RecoveryError</a></div><div class="desc docblock-short">Error type for the <a href="struct.Recovery.html" title="struct matrix_sdk::encryption::recovery::Recovery"><code>Recovery</code></a> subsystem.</div></li><li><div class="item-name"><a class="enum" href="enum.RecoveryState.html" title="enum matrix_sdk::encryption::recovery::RecoveryState">RecoveryState</a></div><div class="desc docblock-short">The states the recovery subsystem can be in.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.Result.html" title="type matrix_sdk::encryption::recovery::Result">Result</a></div><div class="desc docblock-short">Result type alias for the <a href="struct.Recovery.html" title="struct matrix_sdk::encryption::recovery::Recovery"><code>Recovery</code></a> subsystem.</div></li></ul></section></div></main></body></html>