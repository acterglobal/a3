<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Types for extensible text message events (MSC1767)."><title>ruma_events::message - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b1a3e7f8283b8434.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="ruma_events" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0-nightly (d5fd09972 2024-01-22)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="icon" href="https://ruma.io/favicon.ico"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../ruma_events/index.html"><img src="https://ruma.io/images/logo.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../ruma_events/index.html"><img src="https://ruma.io/images/logo.png" alt="logo"></a><h2><a href="../../ruma_events/index.html">ruma_events</a><span class="version">0.27.11</span></h2></div><h2 class="location"><a href="#">Module message</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In crate ruma_events</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../ruma_events/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">ruma_events</a>::<wbr><a class="mod" href="#">message</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/ruma_events/message.rs.html#1-330">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Types for extensible text message events (<a href="https://github.com/matrix-org/matrix-spec-proposals/pull/1767">MSC1767</a>).</p>
<h2 id="extensible-events"><a class="doc-anchor" href="#extensible-events">§</a>Extensible events</h2>
<p><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/1767">MSC1767</a> defines a new structure for events that is made of two parts: a type and zero or more
reusable content blocks.</p>
<p>This allows to construct new event types from a list of known content blocks that allows in turn
clients to be able to render unknown event types by using the known content blocks as a
fallback. When a new type is defined, all the content blocks it can or must contain are defined
too.</p>
<p>There are also some content blocks called “mixins” that can apply to any event when they are
defined.</p>
<h2 id="mscs"><a class="doc-anchor" href="#mscs">§</a>MSCs</h2>
<p>This is a list of MSCs defining the extensible events and deprecating the corresponding legacy
types. Note that “primary type” means the <code>type</code> field at the root of the event and “message
type” means the <code>msgtype</code> field in the content of the <code>m.room.message</code> primary type.</p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/1767">MSC1767</a>: Text messages, where the <code>m.message</code> primary type replaces the <code>m.text</code> message
type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3954">MSC3954</a>: Emotes, where the <code>m.emote</code> primary type replaces the <code>m.emote</code> message type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3955">MSC3955</a>: Automated events, where the <code>m.automated</code> mixin replaces the <code>m.notice</code> message
type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3956">MSC3956</a>: Encrypted events, where the <code>m.encrypted</code> primary type replaces the
<code>m.room.encrypted</code> primary type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3551">MSC3551</a>: Files, where the <code>m.file</code> primary type replaces the <code>m.file</code> message type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3552">MSC3552</a>: Images and Stickers, where the <code>m.image</code> primary type replaces the <code>m.image</code>
message type and the <code>m.sticker</code> primary type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3553">MSC3553</a>: Videos, where the <code>m.video</code> primary type replaces the <code>m.video</code> message type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3927">MSC3927</a>: Audio, where the <code>m.audio</code> primary type replaces the <code>m.audio</code> message type.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3488">MSC3488</a>: Location, where the <code>m.location</code> primary type replaces the <code>m.location</code> message
type.</li>
</ul>
<p>There are also the following MSCs that introduce new features with extensible events:</p>
<ul>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3245">MSC3245</a>: Voice Messages.</li>
<li><a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3246">MSC3246</a>: Audio Waveform.</li>
<li></li>
</ul>
<h2 id="how-to-use-them-in-matrix"><a class="doc-anchor" href="#how-to-use-them-in-matrix">§</a>How to use them in Matrix</h2>
<p>The extensible events types are meant to be used separately than the legacy types. As such,
their use is reserved for room versions that support it.</p>
<p>Currently no stable room version supports extensible events so they can only be sent with
unstable room versions that support them.</p>
<p>An exception is made for some new extensible events types that don’t have a legacy type. They
can be used with stable room versions without support for extensible types, but they might be
ignored by clients that have no support for extensible events. The types that support this must
advertise it in their MSC.</p>
<p>Note that if a room version supports extensible events, it doesn’t support the legacy types
anymore and those should be ignored. There is not yet a definition of the deprecated legacy
types in extensible events rooms.</p>
<h2 id="how-to-use-them-in-ruma"><a class="doc-anchor" href="#how-to-use-them-in-ruma">§</a>How to use them in Ruma</h2>
<p>First, you can enable the <code>unstable-extensible-events</code> feature from the <code>ruma</code> crate, that
will enable all the MSCs for the extensible events that correspond to the legacy types. It
is also possible to enable only the MSCs you want with the <code>unstable-mscXXXX</code> features (where
<code>XXXX</code> is the number of the MSC). When enabling an MSC, all MSC dependencies are enabled at the
same time to avoid issues.</p>
<p>Currently the extensible events use the unstable prefixes as defined in the corresponding MSCs.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.MessageEventContent.html" title="struct ruma_events::message::MessageEventContent">MessageEventContent</a></div><div class="desc docblock-short">The payload for an extensible text message.</div></li><li><div class="item-name"><a class="struct" href="struct.MessageEventContentWithoutRelation.html" title="struct ruma_events::message::MessageEventContentWithoutRelation">MessageEventContentWithoutRelation</a></div><div class="desc docblock-short">Form of <a href="struct.MessageEventContent.html" title="struct ruma_events::message::MessageEventContent"><code>MessageEventContent</code></a> without relation.</div></li><li><div class="item-name"><a class="struct" href="struct.RedactedMessageEventContent.html" title="struct ruma_events::message::RedactedMessageEventContent">RedactedMessageEventContent</a></div><div class="desc docblock-short">Redacted form of <a href="struct.MessageEventContent.html" title="struct ruma_events::message::MessageEventContent"><code>MessageEventContent</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.TextContentBlock.html" title="struct ruma_events::message::TextContentBlock">TextContentBlock</a></div><div class="desc docblock-short">A block for text content with optional markup.</div></li><li><div class="item-name"><a class="struct" href="struct.TextRepresentation.html" title="struct ruma_events::message::TextRepresentation">TextRepresentation</a></div><div class="desc docblock-short">Text content with optional markup.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.MessageEvent.html" title="type ruma_events::message::MessageEvent">MessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event.</div></li><li><div class="item-name"><a class="type" href="type.OriginalMessageEvent.html" title="type ruma_events::message::OriginalMessageEvent">OriginalMessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event.</div></li><li><div class="item-name"><a class="type" href="type.OriginalSyncMessageEvent.html" title="type ruma_events::message::OriginalSyncMessageEvent">OriginalSyncMessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event from a <code>sync_events</code> response.</div></li><li><div class="item-name"><a class="type" href="type.RedactedMessageEvent.html" title="type ruma_events::message::RedactedMessageEvent">RedactedMessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event that has been redacted.</div></li><li><div class="item-name"><a class="type" href="type.RedactedSyncMessageEvent.html" title="type ruma_events::message::RedactedSyncMessageEvent">RedactedSyncMessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event from a <code>sync_events</code> response that has been redacted.</div></li><li><div class="item-name"><a class="type" href="type.SyncMessageEvent.html" title="type ruma_events::message::SyncMessageEvent">SyncMessageEvent</a></div><div class="desc docblock-short">An <code>org.matrix.msc1767.message</code> event from a <code>sync_events</code> response.</div></li></ul></section></div></main></body></html>